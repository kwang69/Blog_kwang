{"ast":null,"code":"import _classCallCheck from \"/Users/kwang/Documents/Projects/FT-REACT/node_modules/@babel/runtime/helpers/esm/classCallCheck\";\nimport _createClass from \"/Users/kwang/Documents/Projects/FT-REACT/node_modules/@babel/runtime/helpers/esm/createClass\";\nimport _possibleConstructorReturn from \"/Users/kwang/Documents/Projects/FT-REACT/node_modules/@babel/runtime/helpers/esm/possibleConstructorReturn\";\nimport _getPrototypeOf from \"/Users/kwang/Documents/Projects/FT-REACT/node_modules/@babel/runtime/helpers/esm/getPrototypeOf\";\nimport _inherits from \"/Users/kwang/Documents/Projects/FT-REACT/node_modules/@babel/runtime/helpers/esm/inherits\";\nvar _jsxFileName = \"/Users/kwang/Documents/Projects/FT-REACT/src/components/Student.js\";\nimport React, { Component } from 'react';\nimport { connect } from 'react-redux';\nimport db from '../data/data';\nimport $ from 'jquery';\nimport { fetchNoteList, fetchNoteDetail, doLogout as _doLogout, uploadFile as _uploadFile, fetchMDDetail, saveMD } from '../actions';\nimport conf from '../config';\nimport { toastIt } from '../components/Toastr/toastr';\nimport { Pagination } from 'antd';\n\nvar _cur_file_name;\n\nvar PAGE_SIZE = 10;\n\nvar Student =\n/*#__PURE__*/\nfunction (_Component) {\n  _inherits(Student, _Component);\n\n  function Student(props) {\n    var _this;\n\n    _classCallCheck(this, Student);\n\n    _this = _possibleConstructorReturn(this, _getPrototypeOf(Student).call(this, props)); //初始化默认用户sys\n\n    _this.componentDidMount = function () {\n      //取系统用户文章列表\n      _this.props.getNoteList('sys');\n    };\n\n    _this.showStInfo = function (e) {\n      var id = $(e.currentTarget).data('id');\n      var st = db.student[id];\n\n      _this.setState({\n        student: st,\n        cur: st.data\n      });\n\n      _this.props.getNoteList(st.data);\n    };\n\n    _this.noteClick = function (e) {\n      if (_this.state.isEdit) return; //设置当前激活状态\n\n      $(\".m-noteitem\").removeClass(\"fn-active\");\n      $(e.currentTarget).parent().addClass(\"fn-active\"); //根据选择id取后台文章内容\n\n      var id = _this.state.cur;\n      var mid = $(e.currentTarget).data('id');\n      var name = _this.props.noteList[mid];\n      _cur_file_name = name;\n\n      _this.props.getNoteDetail(id, name);\n    };\n\n    _this.doUpload = function (e) {\n      var id = _this.props.login.data.user;\n      var file = e.currentTarget.files[0];\n\n      _this.props.uploadFile(file, id);\n    };\n\n    _this.doLogout = function (e) {\n      _this.props.doLogout();\n\n      _this.props.history.push('/');\n    };\n\n    _this.doEdit = function (e) {\n      //判断是否选择文章\n      if (_cur_file_name == null) {\n        toastIt(\"请选择文章！\");\n        return;\n      } //取后台md数据\n\n\n      var id = _this.state.cur;\n\n      _this.props.getMDDetail(id, _cur_file_name);\n\n      _this.setState({\n        isEdit: true\n      });\n    };\n\n    _this.doSave = function (e) {\n      _this.setState({\n        isEdit: false\n      });\n\n      var id = _this.state.cur;\n      var md = $(\".m-edit-body textarea\").val();\n\n      _this.props.saveMDDetail(id, _cur_file_name, md);\n    };\n\n    _this.onChange = function (e) {\n      return _this.setState({\n        mdDetail: e.target.value\n      });\n    };\n\n    _this.onChangePage = function (e) {\n      console.log(e);\n\n      _this.setState({\n        index: e\n      });\n    };\n\n    _this.state = {\n      st: null,\n      cur: 'sys',\n      index: 1,\n      isEdit: false,\n      mdDetail: _this.props.mdDetail\n    };\n    return _this;\n  } //同步state和props的mdDetail\n\n\n  _createClass(Student, [{\n    key: \"componentWillReceiveProps\",\n    value: function componentWillReceiveProps(nextProps) {\n      if (nextProps.mdDetail !== this.props.mdDetail) {\n        this.setState({\n          mdDetail: nextProps.mdDetail\n        });\n      }\n    }\n  }, {\n    key: \"render\",\n    value: function render() {\n      var _this2 = this;\n\n      var stImg = \"#\";\n      var tech = [];\n      var stList = db.student;\n      var hostPre = conf.host + 'img/';\n      var _this$state = this.state,\n          student = _this$state.student,\n          isEdit = _this$state.isEdit,\n          index = _this$state.index;\n      var _this$props = this.props,\n          noteList = _this$props.noteList,\n          noteDetail = _this$props.noteDetail,\n          isLogin = _this$props.isLogin;\n      var total;\n      var data = [];\n\n      if (typeof noteList === 'undefined') {\n        noteList = [];\n        total = 0;\n      } else {\n        total = noteList.length;\n\n        for (var i = 0; i < PAGE_SIZE; i++) {\n          var offset = (index - 1) * PAGE_SIZE;\n          if (offset + i >= noteList.length) break;\n          var item = noteList[i + offset];\n          data.push(item);\n        }\n      }\n\n      if (student !== null && typeof student !== 'undefined') {\n        stImg = student.img;\n        tech = student.techList;\n      }\n\n      var _loop = function _loop(_i) {\n        var techArr = [];\n\n        stList[_i].tech.split('/').forEach(function (v) {\n          techArr.push({\n            \"val\": v,\n            \"cls\": \"m-\" + v\n          });\n        });\n\n        stList[_i].techList = techArr;\n      };\n\n      for (var _i = 0; _i < stList.length; _i++) {\n        _loop(_i);\n      }\n\n      return React.createElement(\"div\", {\n        className: \"g-st\",\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 146\n        },\n        __self: this\n      }, React.createElement(\"div\", {\n        className: \"m-bar\",\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 147\n        },\n        __self: this\n      }, React.createElement(\"div\", {\n        className: \"m-st-logo\",\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 148\n        },\n        __self: this\n      }, React.createElement(\"img\", {\n        src: hostPre + stImg,\n        alt: \"\",\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 149\n        },\n        __self: this\n      })), React.createElement(\"div\", {\n        className: \"m-st-tech\",\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 152\n        },\n        __self: this\n      }, tech.map(function (item, i) {\n        return React.createElement(\"span\", {\n          className: \"m-tech \" + item.cls,\n          key: i,\n          __source: {\n            fileName: _jsxFileName,\n            lineNumber: 155\n          },\n          __self: this\n        }, item.val);\n      })), isLogin ? React.createElement(\"div\", {\n        className: \"m-func\",\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 161\n        },\n        __self: this\n      }, React.createElement(\"button\", {\n        className: isEdit ? 'fn-hide' : '',\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 162\n        },\n        __self: this\n      }, React.createElement(\"input\", {\n        type: \"file\",\n        onChange: this.doUpload,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 163\n        },\n        __self: this\n      }), \"Upload Note\"), React.createElement(\"button\", {\n        onClick: this.doEdit,\n        className: isEdit ? 'fn-hide' : '',\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 164\n        },\n        __self: this\n      }, \"Edit Note\"), React.createElement(\"button\", {\n        onClick: this.doSave,\n        className: !isEdit ? 'fn-hide' : '',\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 165\n        },\n        __self: this\n      }, \"Save Note\"), React.createElement(\"button\", {\n        className: isEdit ? 'fn-hide' : '',\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 166\n        },\n        __self: this\n      }, \"Delete Note\"), React.createElement(\"button\", {\n        onClick: this.doLogout,\n        className: isEdit ? 'fn-hide' : '',\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 167\n        },\n        __self: this\n      }, \"Logo Out\")) : ''), React.createElement(\"div\", {\n        className: \"m-list\",\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 171\n        },\n        __self: this\n      }, React.createElement(\"div\", {\n        className: \"m-notelist\",\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 172\n        },\n        __self: this\n      }, data.map(function (item, i) {\n        return React.createElement(\"div\", {\n          className: \"m-noteitem\",\n          key: i,\n          __source: {\n            fileName: _jsxFileName,\n            lineNumber: 175\n          },\n          __self: this\n        }, React.createElement(\"span\", {\n          __source: {\n            fileName: _jsxFileName,\n            lineNumber: 176\n          },\n          __self: this\n        }, item.split('@')[0]), React.createElement(\"a\", {\n          href: \"#{i}\",\n          \"data-id\": i + (index - 1) * PAGE_SIZE,\n          onClick: _this2.noteClick,\n          __source: {\n            fileName: _jsxFileName,\n            lineNumber: 177\n          },\n          __self: this\n        }, item.split('@')[1]));\n      })), React.createElement(Pagination, {\n        size: \"small\",\n        onChange: this.onChangePage,\n        total: total,\n        defaultPageSize: PAGE_SIZE,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 182\n        },\n        __self: this\n      })), React.createElement(\"div\", {\n        className: \"m-main\",\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 184\n        },\n        __self: this\n      }, !isEdit ? React.createElement(\"div\", {\n        className: \"m-md-body\",\n        dangerouslySetInnerHTML: {\n          __html: noteDetail\n        },\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 186\n        },\n        __self: this\n      }) : React.createElement(\"div\", {\n        className: \"m-edit-body\",\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 188\n        },\n        __self: this\n      }, React.createElement(\"textarea\", {\n        value: this.state.mdDetail,\n        onChange: this.onChange,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 189\n        },\n        __self: this\n      }))), React.createElement(\"div\", {\n        className: \"m-st-list\",\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 193\n        },\n        __self: this\n      }, stList.map(function (item, i) {\n        return React.createElement(\"div\", {\n          className: \"m-st-item\",\n          key: i,\n          onClick: _this2.showStInfo,\n          \"data-id\": i,\n          __source: {\n            fileName: _jsxFileName,\n            lineNumber: 196\n          },\n          __self: this\n        }, React.createElement(\"img\", {\n          src: hostPre + item.img,\n          alt: \"\",\n          __source: {\n            fileName: _jsxFileName,\n            lineNumber: 197\n          },\n          __self: this\n        }), React.createElement(\"span\", {\n          __source: {\n            fileName: _jsxFileName,\n            lineNumber: 198\n          },\n          __self: this\n        }, item.name));\n      })));\n    }\n  }]);\n\n  return Student;\n}(Component);\n\nvar mapStateToProps = function mapStateToProps(state) {\n  return {\n    noteList: state.noteList,\n    noteDetail: state.noteDetail,\n    isLogin: state.isLogin,\n    login: state.login,\n    file: state.file,\n    mdDetail: state.mdDetail\n  };\n};\n\nvar mapDispatchToProps = function mapDispatchToProps(dispatch) {\n  return {\n    getNoteList: function getNoteList(id) {\n      dispatch(fetchNoteList(id));\n    },\n    getNoteDetail: function getNoteDetail(id, name) {\n      dispatch(fetchNoteDetail(id, name));\n    },\n    doLogout: function doLogout() {\n      dispatch(_doLogout());\n    },\n    uploadFile: function uploadFile(file, id) {\n      dispatch(_uploadFile(file, id));\n    },\n    getMDDetail: function getMDDetail(id, name) {\n      dispatch(fetchMDDetail(id, name));\n    },\n    saveMDDetail: function saveMDDetail(id, name, md) {\n      dispatch(saveMD(id, name, md));\n    }\n  };\n};\n\nexport default connect(mapStateToProps, mapDispatchToProps)(Student);","map":{"version":3,"sources":["/Users/kwang/Documents/Projects/FT-REACT/src/components/Student.js"],"names":["React","Component","connect","db","$","fetchNoteList","fetchNoteDetail","doLogout","uploadFile","fetchMDDetail","saveMD","conf","toastIt","Pagination","_cur_file_name","PAGE_SIZE","Student","props","componentDidMount","getNoteList","showStInfo","e","id","currentTarget","data","st","student","setState","cur","noteClick","state","isEdit","removeClass","parent","addClass","mid","name","noteList","getNoteDetail","doUpload","login","user","file","files","history","push","doEdit","getMDDetail","doSave","md","val","saveMDDetail","onChange","mdDetail","target","value","onChangePage","console","log","index","nextProps","stImg","tech","stList","hostPre","host","noteDetail","isLogin","total","length","i","offset","item","img","techList","techArr","split","forEach","v","map","cls","__html","mapStateToProps","mapDispatchToProps","dispatch"],"mappings":"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","sourcesContent":["import React, { Component }  from 'react';\nimport { connect } from 'react-redux';\nimport db from '../data/data';\nimport $ from 'jquery';\nimport { fetchNoteList, fetchNoteDetail, doLogout, uploadFile, fetchMDDetail,saveMD } from '../actions';\nimport conf from '../config';\nimport {toastIt} from '../components/Toastr/toastr';\nimport { Pagination } from 'antd';\n\nvar _cur_file_name;\nconst PAGE_SIZE = 10;\n\nclass Student extends Component {\n\n  constructor(props) {\n    super(props);\n\n    //初始化默认用户sys\n    this.state = {\n      st:null, \n      cur:'sys', \n      index: 1,\n      isEdit: false, \n      mdDetail: this.props.mdDetail\n    };\n  }\n\n  //同步state和props的mdDetail\n  componentWillReceiveProps(nextProps) {\n    if (nextProps.mdDetail !== this.props.mdDetail) {\n      this.setState({\n        mdDetail: nextProps.mdDetail\n      });\n    }\n  }\n\n  componentDidMount = () =>{\n    //取系统用户文章列表\n    this.props.getNoteList('sys');\n  }\n\n  //显示当前用户文章\n  showStInfo = (e) => {\n    let id = $(e.currentTarget).data('id');\n    let st = db.student[id];\n    this.setState( { student: st, cur: st.data });\n    this.props.getNoteList(st.data);\n  }\n\n  //显示点击文档内容\n  noteClick = (e) => {\n    if (this.state.isEdit) return;\n\n    //设置当前激活状态\n    $(\".m-noteitem\").removeClass(\"fn-active\");\n    $(e.currentTarget).parent().addClass(\"fn-active\");\n\n    //根据选择id取后台文章内容\n    let id = this.state.cur;\n    let mid = $(e.currentTarget).data('id');\n    let name = this.props.noteList[mid];\n    _cur_file_name = name;\n    this.props.getNoteDetail(id,name);\n  }\n\n  //上传MD格式文档\n  doUpload = (e)=> {\n    let id = this.props.login.data.user;\n    let file = e.currentTarget.files[0];\n    this.props.uploadFile(file,id);\n  }\n\n  //登出系统\n  doLogout = (e) => {\n    this.props.doLogout();\n    this.props.history.push('/')\n  }\n\n  //编辑文章\n  doEdit = (e) => {\n    //判断是否选择文章\n    if (_cur_file_name == null) {\n      toastIt(\"请选择文章！\");\n      return;\n    }\n    //取后台md数据\n    let id = this.state.cur;\n    this.props.getMDDetail(id,_cur_file_name);\n    this.setState( {isEdit:true} );\n  }\n\n  //保存编辑md数据\n  doSave = (e) => {\n    this.setState( {isEdit:false} );\n\n    let id = this.state.cur;\n    let md = $(\".m-edit-body textarea\").val();\n    this.props.saveMDDetail(id,_cur_file_name,md);\n  }\n\n  onChange = e => this.setState({ mdDetail: e.target.value })\n\n\n  onChangePage = (e) => {\n    console.log(e)\n    this.setState({index: e});\n  }\n\n  render() {\n    let stImg = \"#\";\n    let tech = [];\n    let stList = db.student;\n    let hostPre = conf.host + 'img/';\n    let { student,isEdit,index } = this.state;\n    let { noteList,noteDetail,isLogin } = this.props;\n    let total;\n    let data = [];\n\n    if ((typeof(noteList)==='undefined')) {\n      noteList = [];\n      total = 0;\n    }else{\n      total = noteList.length;\n      for(var i=0;i<PAGE_SIZE;i++) {\n        var offset = (index-1)*PAGE_SIZE;\n        if (offset + i>=noteList.length) break;\n        var item = noteList[i + offset];\n        data.push(item);\n      }\n    }\n    \n    if ((student !== null)&&(typeof(student)!=='undefined')) {\n      stImg = student.img;\n      tech = student.techList;\n    }\n\n    for(let i=0;i<stList.length;i++) {\n      let techArr = [];\n      stList[i].tech.split('/').forEach(v=>{\n        techArr.push({\"val\":v,\"cls\":\"m-\"+v})\n      });\n      stList[i].techList = techArr;\n    }\n\n    return (\n      <div className=\"g-st\">\n        <div className=\"m-bar\">\n          <div className=\"m-st-logo\">\n            <img src={hostPre+stImg} alt=\"\"/>\n          </div>\n          \n          <div className=\"m-st-tech\">\n            {tech.map((item,i)=>{\n              return(\n                <span className={\"m-tech \" + item.cls} key={i}>{item.val}</span>\n              )\n            })}\n          </div>\n\n          {isLogin?(\n          <div className=\"m-func\">\n            <button className={isEdit?'fn-hide':''}>\n              <input type=\"file\" onChange={this.doUpload}/>Upload Note</button>\n            <button onClick={this.doEdit} className={isEdit?'fn-hide':''}>Edit Note</button>\n            <button onClick={this.doSave} className={!isEdit?'fn-hide':''}>Save Note</button>\n            <button className={isEdit?'fn-hide':''}>Delete Note</button>\n            <button onClick={this.doLogout} className={isEdit?'fn-hide':''}>Logo Out</button>\n          </div>):''}\n           \n        </div>\n        <div className=\"m-list\">\n          <div className=\"m-notelist\">\n            {data.map((item,i)=>{\n              return(\n                <div className=\"m-noteitem\" key={i} >\n                  <span>{item.split('@')[0]}</span>\n                  <a href=\"#{i}\"  data-id={i+(index-1)*PAGE_SIZE} onClick={this.noteClick}>{item.split('@')[1]}</a>\n                </div>\n              )\n            })}\n          </div>\n          <Pagination size=\"small\" onChange={this.onChangePage} total={total} defaultPageSize={PAGE_SIZE}/>\n        </div>\n        <div className=\"m-main\">\n          {!isEdit?(\n            <div className=\"m-md-body\" dangerouslySetInnerHTML = {{ __html:noteDetail }}></div>\n          ):(\n            <div className=\"m-edit-body\">\n              <textarea value={this.state.mdDetail} onChange={this.onChange} ></textarea>\n            </div>\n          )}\n        </div>\n        <div className=\"m-st-list\">\n          {stList.map((item,i)=>{\n            return(\n              <div className=\"m-st-item\" key={i} onClick={this.showStInfo} data-id={i}>\n                <img src={hostPre+item.img} alt=\"\"/>\n                <span>{item.name}</span>\n              </div>\n            )\n          })}\n        </div>\n      </div>\n    )\n  }\n}\n\nconst mapStateToProps  = (state) => ({\n  noteList: state.noteList,\n  noteDetail: state.noteDetail,\n  isLogin: state.isLogin,\n  login: state.login,\n  file: state.file,\n  mdDetail: state.mdDetail\n});\n\nconst mapDispatchToProps = (dispatch) => {\n  return {\n    getNoteList: (id) => {\n      dispatch(fetchNoteList(id));\n    },\n    getNoteDetail: (id,name) => {\n      dispatch(fetchNoteDetail(id,name));\n    },\n    doLogout: ()=> {\n      dispatch(doLogout());\n    },\n    uploadFile: (file,id) => {\n      dispatch(uploadFile(file,id));\n    },\n    getMDDetail: (id,name) => {\n      dispatch(fetchMDDetail(id,name));\n    },\n    saveMDDetail: (id,name,md) => {\n      dispatch(saveMD(id,name,md));\n    },\n  }\n}\n\n\nexport default connect(mapStateToProps,mapDispatchToProps)(Student);\n\n"]},"metadata":{},"sourceType":"module"}